<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</title>

<style>
body {
    background:#000;
    color:#fff;
    font-family:Tajawal, Arial;
    text-align:center;
    padding:20px;
}

h2 {
    color:gold;
}

button {
    background:gold;
    color:#000;
    padding:10px 15px;
    border:none;
    border-radius:8px;
    font-size:18px;
    cursor:pointer;
}

/* Popup */
#popup {
    display:none;
    position:fixed;
    top:0; left:0; right:0; bottom:0;
    background:rgba(0,0,0,0.8);
    justify-content:center;
    align-items:center;
}

.popup-box {
    background:#111;
    padding:20px;
    border:2px solid gold;
    border-radius:12px;
    width:90%;
    max-width:400px;
}

input {
    width:100%;
    padding:10px;
    margin:8px 0;
    border-radius:8px;
    border:1px solid gold;
    background:#222;
    color:#fff;
}

table {
    width:100%;
    border-collapse:collapse;
    margin-top:20px;
}

th, td {
    border:1px solid gold;
    padding:10px;
}
th { background:#222; color:gold; }
</style>
</head>

<body>

<h2>ğŸ“¦ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>

<button onclick="openPopup()">â• Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</button>

<table>
<thead>
<tr>
<th>Ø§Ù„ÙƒÙˆØ¯</th>
<th>Ø§Ù„Ø§Ø³Ù…</th>
<th>Ø´Ø±Ø§Ø¡</th>
<th>Ø¨ÙŠØ¹</th>
<th>ÙƒÙ…ÙŠØ©</th>
</tr>
</thead>
<tbody id="productsTable"></tbody>
</table>

<!-- Popup -->
<div id="popup">
    <div class="popup-box">
        <h3 style="color:gold;">Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù Ø¬Ø¯ÙŠØ¯</h3>

        <input id="pCode" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù">
        <input id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
        <input id="pBuy" type="number" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">
        <input id="pSell" type="number" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">
        <input id="pQty" type="number" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">

        <button onclick="saveProduct()">Ø­ÙØ¸</button>
        <button onclick="closePopup()" style="background:#444; color:#fff; margin-top:5px;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script type="module">
import { supabase } from "../supabase.js";

function openPopup(){ document.getElementById("popup").style.display="flex"; }
function closePopup(){ document.getElementById("popup").style.display="none"; }

async function loadProducts() {
    const table = document.getElementById("productsTable");

    const { data, error } = await supabase
        .from("products")
        .select("*")
        .order("id", { ascending:false });

    table.innerHTML = "";

    data.forEach(p=>{
        table.innerHTML += `
        <tr>
            <td>${p.product_code}</td>
            <td>${p.name}</td>
            <td>${p.buy}</td>
            <td>${p.sell}</td>
            <td>${p.quantity}</td>
        </tr>`;
    });
}

async function saveProduct() {
    const pCode = document.getElementById("pCode").value.trim();
    const pName = document.getElementById("pName").value.trim();
    const pBuy  = document.getElementById("pBuy").value;
    const pSell = document.getElementById("pSell").value;
    const pQty  = document.getElementById("pQty").value;

    if (!pCode || !pName) {
        alert("ÙŠØ¬Ø¨ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„Ø§Ø³Ù…");
        return;
    }

    const { error } = await supabase.from("products").insert({
        product_code: pCode,
        name: pName,
        buy: pBuy,
        sell: pSell,
        quantity: pQty
    });

    if (error) {
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸");
        return;
    }

    closePopup();
    loadProducts(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
}

loadProducts();
</script>

</body>
</html>
