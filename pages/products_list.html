<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</title>

<style>
body {
    background:#000;
    color:#fff;
    font-family:Tajawal, Arial;
    text-align:center;
    padding:20px;
}

h2 {
    color:gold;
    margin-bottom:15px;
}

button {
    background:gold;
    color:#000;
    padding:8px 15px;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-size:16px;
    font-weight:bold;
}

table {
    width:100%;
    margin-top:20px;
    border-collapse:collapse;
}

th, td {
    border:1px solid gold;
    padding:10px;
}

th {
    background:#222;
    color:gold;
}

.action-btn {
    background:#444;
    color:#fff;
    padding:5px 10px;
    border-radius:6px;
    margin:2px;
}

/* Popup */
#popup, #editPopup {
    display:none;
    position:fixed;
    top:0; left:0; right:0; bottom:0;
    background:rgba(0,0,0,0.8);
    justify-content:center;
    align-items:center;
}

.popup-box {
    background:#111;
    padding:20px;
    border:2px solid gold;
    border-radius:12px;
    width:90%;
    max-width:400px;
}

input {
    width:100%;
    padding:10px;
    margin:8px 0;
    border-radius:8px;
    border:1px solid gold;
    background:#222;
    color:#fff;
}
</style>
</head>

<body>

<h2>ğŸ“¦ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>

<button onclick="openPopup()">â• Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</button>

<table>
<thead>
<tr>
<th>Ø§Ù„ÙƒÙˆØ¯</th>
<th>Ø§Ù„Ø§Ø³Ù…</th>
<th>Ø´Ø±Ø§Ø¡</th>
<th>Ø¨ÙŠØ¹</th>
<th>ÙƒÙ…ÙŠØ©</th>
<th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
</tr>
</thead>
<tbody id="productsTable"></tbody>
</table>

<!-- Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù -->
<div id="popup">
    <div class="popup-box">
        <h3 style="color:gold;">Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù Ø¬Ø¯ÙŠØ¯</h3>

        <input id="addCode" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù">
        <input id="addName" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
        <input id="addBuy" type="number" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">
        <input id="addSell" type="number" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">
        <input id="addQty" type="number" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">

        <button onclick="saveProduct()">Ø­ÙØ¸</button>
        <button onclick="closePopup()" style="background:#444; color:#fff;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<!-- ØªØ¹Ø¯ÙŠÙ„ ØµÙ†Ù -->
<div id="editPopup">
    <div class="popup-box">
        <h3 style="color:gold;">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</h3>

        <input id="editCode">
        <input id="editName">
        <input id="editBuy" type="number">
        <input id="editSell" type="number">
        <input id="editQty" type="number">

        <button onclick="updateProduct()">ØªØ­Ø¯ÙŠØ«</button>
        <button onclick="closeEditPopup()" style="background:#444; color:#fff;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script type="module">
import { supabase } from "../supabase.js";

let editId = null;

/* --------- Ø±Ø¨Ø· Ø§Ù„Ø¯ÙˆØ§Ù„ Ø¨Ø§Ù„Ù€ window Ø¹Ø´Ø§Ù† ØªØ´ØªØºÙ„ ---------- */

window.openPopup = function () {
    document.getElementById("popup").style.display = "flex";
}

window.closePopup = function () {
    document.getElementById("popup").style.display = "none";
}

window.closeEditPopup = function () {
    document.getElementById("editPopup").style.display = "none";
}

/* -------- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -------- */

async function loadProducts() {
    const table = document.getElementById("productsTable");

    const { data, error } = await supabase
        .from("products")
        .select("*")
        .order("id", { ascending:false });

    if (error) {
        table.innerHTML = "<tr><td colspan='6'>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>";
        return;
    }

    table.innerHTML = "";

    data.forEach(p => {
        table.innerHTML += `
        <tr>
            <td>${p.product_code}</td>
            <td>${p.name}</td>
            <td>${p.buy}</td>
            <td>${p.sell}</td>
            <td>${p.quantity}</td>
            <td>
                <button class="action-btn" onclick="editProduct(${p.id}, '${p.product_code}', '${p.name}', ${p.buy}, ${p.sell}, ${p.quantity})">âœ ØªØ¹Ø¯ÙŠÙ„</button>
                <button class="action-btn" onclick="deleteProduct(${p.id})" style="background:red;">ğŸ—‘ Ø­Ø°Ù</button>
            </td>
        </tr>`;
    });
}

/* -------- Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ -------- */

window.saveProduct = async function () {
    const pCode = document.getElementById("addCode").value;
    const pName = document.getElementById("addName").value;
    const pBuy  = document.getElementById("addBuy").value;
    const pSell = document.getElementById("addSell").value;
    const pQty  = document.getElementById("addQty").value;

    await supabase.from("products").insert({
        product_code: pCode,
        name: pName,
        buy: pBuy,
        sell: pSell,
        quantity: pQty
    });

    closePopup();
    loadProducts();
}

/* -------- ØªØ¬Ù‡ÙŠØ² Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ -------- */

window.editProduct = function (id, code, name, buy, sell, qty) {
    editId = id;

    document.getElementById("editCode").value = code;
    document.getElementById("editName").value = name;
    document.getElementById("editBuy").value  = buy;
    document.getElementById("editSell").value = sell;
    document.getElementById("editQty").value  = qty;

    document.getElementById("editPopup").style.display = "flex";
}

/* -------- ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ -------- */

window.updateProduct = async function () {
    await supabase.from("products")
        .update({
            product_code: document.getElementById("editCode").value,
            name: document.getElementById("editName").value,
            buy: document.getElementById("editBuy").value,
            sell: document.getElementById("editSell").value,
            quantity: document.getElementById("editQty").value
        })
        .eq("id", editId);

    closeEditPopup();
    loadProducts();
}

/* -------- Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ -------- */

window.deleteProduct = async function (id) {
    if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ")) return;

    await supabase.from("products").delete().eq("id", id);
    loadProducts();
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„ Ù…Ø±Ø©
loadProducts();
</script>

</body>
</html>
