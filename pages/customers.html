<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ | SmartKey Pro</title>

<style>
    body {
        background:#000;
        color:#fff;
        font-family:Tajawal, sans-serif;
        padding:20px;
    }
    h2 {
        color:gold;
        text-align:center;
        margin-bottom:20px;
    }
    input {
        width:95%;
        padding:10px;
        margin:5px 0;
        border-radius:8px;
        border:1px solid gold;
        background:#111;
        color:#fff;
        font-size:16px;
    }
    button {
        background:gold;
        color:#000;
        padding:10px 20px;
        border:none;
        border-radius:8px;
        cursor:pointer;
        font-weight:bold;
        font-size:16px;
        margin-top:10px;
    }
    table {
        width:100%;
        margin-top:20px;
        border-collapse:collapse;
        font-size:16px;
    }
    th, td {
        border:1px solid gold;
        padding:10px;
        text-align:center;
    }
    th {
        background:#222;
        color:gold;
    }
    .delete-btn {
        background:red;
        color:white;
        padding:5px 10px;
        border-radius:5px;
        cursor:pointer;
    }
</style>
</head>

<body>

<h2>Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</h2>

<div style="background:#111; border:1px solid gold; padding:15px; border-radius:10px;">
    <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</label>
    <input type="text" id="customerName">

    <label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„:</label>
    <input type="text" id="customerPhone">

    <button id="saveCustomer">â• Ø­ÙØ¸ Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
</div>

<h2>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>

<table id="customersTable">
    <thead>
        <tr>
            <th>Ø§Ù„Ø§Ø³Ù…</th>
            <th>Ø§Ù„Ø¬ÙˆØ§Ù„</th>
            <th>ØªØ­ÙƒÙ…</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script type="module">
import { supabase } from "../supabase.js";

/* ============ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ ============ */
document.getElementById("saveCustomer").addEventListener("click", async () => {
    const name = document.getElementById("customerName").value.trim();
    const phone = document.getElementById("customerPhone").value.trim();

    if (!name || !phone) {
        alert("âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„");
        return;
    }

    const { error } = await supabase
        .from("customers")
        .insert([{ name, phone, balance: 0 }]);

    if (error) {
        alert("âŒ ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸");
        console.log(error);
    } else {
        alert("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­");
        document.getElementById("customerName").value = "";
        document.getElementById("customerPhone").value = "";
        loadCustomers();
    }
});

/* ============ Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ============ */
async function loadCustomers() {
    const { data, error } = await supabase
        .from("customers")
        .select("*")
        .order("created_at", { ascending: false });

    const tbody = document.querySelector("#customersTable tbody");
    tbody.innerHTML = "";

    data.forEach(cust => {
        tbody.innerHTML += `
            <tr>
                <td>${cust.name}</td>
                <td>${cust.phone}</td>
                <td>
                    <button class="delete-btn" onclick="deleteCustomer('${cust.id}')">Ø­Ø°Ù</button>
                </td>
            </tr>
        `;
    });
}

/* ============ Ø­Ø°Ù Ø¹Ù…ÙŠÙ„ ============ */
window.deleteCustomer = async function(id) {
    const ok = confirm("â— Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ØŸ");
    if (!ok) return;

    await supabase.from("customers").delete().eq("id", id);
    alert("ğŸ—‘ï¸ ØªÙ… Ø§Ù„Ø­Ø°Ù");
    loadCustomers();
};

/* ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ */
loadCustomers();

</script>

</body>
</html>
