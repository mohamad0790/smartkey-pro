<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù Ø¬Ø¯ÙŠØ¯</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    body {
        background:#000;
        color:#fff;
        font-family:Tajawal, sans-serif;
        padding:20px;
        text-align:center;
    }
    h2 {
        color:gold;
        margin-bottom:20px;
    }
    input {
        width:90%;
        padding:12px;
        margin:10px auto;
        border-radius:10px;
        border:1px solid gold;
        background:#111;
        color:#fff;
        font-size:18px;
        display:block;
    }
    button {
        background:gold;
        color:#000;
        padding:12px;
        width:90%;
        border:none;
        border-radius:10px;
        font-size:20px;
        font-weight:bold;
        margin-top:10px;
        cursor:pointer;
    }
</style>
</head>

<body>

<h2>ğŸ“¦ Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù Ø¬Ø¯ÙŠØ¯</h2>

<input id="productCode" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù">
<input id="productName" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
<input id="buyPrice" type="number" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">
<input id="sellPrice" type="number" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">
<input id="quantity" type="number" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">

<button id="addProduct">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙ†Ù</button>

<!-- Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Supabase -->
<script type="module">
import { supabase } from "../supabase.js";

/* ========== Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù ========== */
document.getElementById("addProduct").addEventListener("click", async () => {

    let code = document.getElementById("productCode").value.trim();
    let name = document.getElementById("productName").value.trim();
    let buy = Number(document.getElementById("buyPrice").value);
    let sell = Number(document.getElementById("sellPrice").value);
    let qty = Number(document.getElementById("quantity").value);

    // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª
    if (!code || !name || !buy || !sell || !qty) {
        alert("âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­");
        return;
    }

    if (buy <= 0 || sell <= 0 || qty <= 0) {
        alert("âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ù‚ÙŠÙ… ØµÙØ± Ø£Ùˆ Ø£Ù‚Ù„");
        return;
    }

    // Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ = Ù‡Ùˆ Ù†ÙØ³Ù‡ ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù
    let barcode = code;

    // Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙÙŠ Supabase
    const { error } = await supabase
        .from("products")
        .insert([{
            product_code: code,
            name: name,
            buy: buy,
            sell: sell,
            quantity: qty,
            barcode: barcode
        }]);

    if (error) {
        console.log(error);
        alert("âŒ ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„ØµÙ†Ù");
    } else {
        alert("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙ†Ù Ø¨Ù†Ø¬Ø§Ø­");

        // ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚ÙˆÙ„
        document.getElementById("productCode").value = "";
        document.getElementById("productName").value = "";
        document.getElementById("buyPrice").value = "";
        document.getElementById("sellPrice").value = "";
        document.getElementById("quantity").value = "";

        // ØªØ­ÙˆÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        setTimeout(() => {
            location.href = "products.html";
        }, 400);
    }
});
</script>

</body>
</html>
