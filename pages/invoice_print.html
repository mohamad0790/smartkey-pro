<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
title>ุทุจุงุนุฉ ูุงุชูุฑุฉ</title>
<style>
    body {
        font-family: Arial;
        width: 210mm;
        margin: auto;
        background: #fff;
        color: #000;
    }
    .invoice-box {
        padding: 20px;
        border: 2px solid #000;
    }
    h2, h3 {
        margin: 5px 0;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }
    th, td {
        border: 1px solid #000;
        padding: 8px;
        text-align: center;
    }
    .no-border td {
        border: none;
    }
    .header {
        text-align: center;
        margin-bottom: 10px;
    }
    .footer {
        margin-top: 25px;
        text-align: center;
        font-size: 14px;
    }
    @media print {
        body {
            margin: 0;
        }
    }
</style>
<script type="module">
import { supabase } from "../supabase.js";

async function loadInvoice() {
    const url = new URL(window.location.href);
    const id = url.searchParams.get("id");

    if (!id) {
        alert("ุฎุทุฃ: ูุง ููุฌุฏ ุฑูู ูุงุชูุฑุฉ");
        return;
    }

    // ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ ูููุงุชูุฑุฉ
    const { data: sale } = await supabase
        .from("sales")
        .select("*, customers(name, phone)")
        .eq("id", id)
        .single();

    if (!sale) {
        alert("ุงููุงุชูุฑุฉ ุบูุฑ ููุฌูุฏุฉ");
        return;
    }

    // ุชูุงุตูู ุงูุฃุตูุงู
    const { data: items } = await supabase
        .from("sale_items")
        .select("*, products(name)")
        .eq("sale_id", id);

    document.getElementById("invoiceId").textContent = sale.id;
    document.getElementById("customerName").textContent = sale.customers.name;
    document.getElementById("customerPhone").textContent = sale.customers.phone || "โ";

    document.getElementById("total").textContent = sale.total;
    document.getElementById("paid").textContent = sale.paid;
    document.getElementById("remaining").textContent = sale.remaining;
    document.getElementById("oldBalance").textContent = sale.previous_balance;
    document.getElementById("newBalance").textContent = sale.new_balance;

    // ุฑุณู ุฌุฏูู ุงูุฃุตูุงู
    const table = document.getElementById("itemsTable");
    items.forEach(it => {
        table.innerHTML += `
            <tr>
                <td>${it.products.name}</td>
                <td>${it.price}</td>
                <td>${it.qty}</td>
                <td>${it.total}</td>
            </tr>
        `;
    });
}

window.onload = loadInvoice;
</script>
</head>

<body>

<div class="invoice-box">

<div class="header">
    <h2>ูุคุณุณุฉ ูุณุฎ ูููุฒ ููููุงุชูุญ</h2>
    <p>ุงูุฑูุงุถ - ุญู ุงูุณูููุงููุฉ</p>
    <p>ุฌูุงู: 0550000000</p>
</div>

<h3>ูุงุชูุฑุฉ ูุจูุนุงุช ุฑูู: <span id="invoiceId"></span></h3>

<table class="no-border">
    <tr>
        <td><strong>ุงุณู ุงูุนููู:</strong> <span id="customerName"></span></td>
        <td><strong>ุฑูู ุงูุนููู:</strong> <span id="customerPhone"></span></td>
    </tr>
</table>

<h3>ุชูุงุตูู ุงูุฃุตูุงู</h3>
<table>
    <thead>
        <tr>
            <th>ุงูุตูู</th>
            <th>ุงูุณุนุฑ</th>
            <th>ุงููููุฉ</th>
            <th>ุงูุฅุฌูุงูู</th>
        </tr>
    </thead>
    <tbody id="itemsTable"></tbody>
</table>

<h3>ุงูููุฎุต ุงููุงูู</h3>
<table>
<tr><td>ุฅุฌูุงูู ุงููุงุชูุฑุฉ</td><td id="total"></td></tr>
<tr><td>ุงููุจูุบ ุงููุฏููุน</td><td id="paid"></td></tr>
<tr><td>ุงููุชุจูู</td><td id="remaining"></td></tr>
<tr><td>ุงูุฑุตูุฏ ุงูุณุงุจู</td><td id="oldBalance"></td></tr>
<tr><td>ุงูุฑุตูุฏ ุงูุฌุฏูุฏ</td><td id="newBalance"></td></tr>
</table>

<div class="footer">
    <p>ุดูุฑุงู ูุชุนุงูููู ูุนูุง</p>
    <p>ูุณุฎ ูููุฒ ููููุงุชูุญ ยฉ 2025</p>
</div>

</div>

<script>
function printPage() {
    window.print();
}
</script>

<button onclick="printPage()" style="width:100%; padding:15px; background:black; color:white; font-size:20px;">
๐จ๏ธ ุทุจุงุนุฉ ุงููุงุชูุฑุฉ
</button>

</body>
</html>
