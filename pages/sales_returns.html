<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù…Ø±ØªØ¬Ø¹Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª | SmartKey Pro</title>

    <style>
        body { font-family: sans-serif; direction: rtl; padding: 15px; }
        label { display: block; margin-top: 10px; font-weight: bold; }
        input, select, textarea {
            width: 100%; padding: 10px; margin-top: 5px; border-radius: 6px;
            border: 1px solid #ccc; font-size: 16px;
        }
        button {
            width: 100%; padding: 12px; background: #000; color: #fff;
            border: none; border-radius: 6px; margin-top: 20px;
            font-size: 18px; cursor: pointer;
        }
    </style>

    <script type="module">
        import { supabase } from "../js/supabase.js";

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
        const loadInvoices = async () => {
            const { data } = await supabase.from("sales_invoices").select("*");
            let sel = document.getElementById("invoice");
            sel.innerHTML = "<option value=''>Ø§Ø®ØªØ± Ø§Ù„ÙØ§ØªÙˆØ±Ø©</option>";
            data.forEach(inv => {
                sel.innerHTML += `<option value="${inv.id}">ÙØ§ØªÙˆØ±Ø© #${inv.id.slice(0, 6)} - ${inv.total_amount}</option>`;
            });
        };

        // Ø­ÙØ¸ Ø§Ù„Ù…Ø±ØªØ¬Ø¹
        const saveReturn = async () => {
            let invoice = document.getElementById("invoice").value;
            let product = document.getElementById("product").value;
            let qty = document.getElementById("qty").value;
            let reason = document.getElementById("reason").value;

            if (!invoice || !product || !qty) {
                alert("ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
                return;
            }

            const { error } = await supabase.from("sales_returns").insert({
                sale_id: invoice,
                product_id: product,
                quantity: qty,
                reason: reason
            });

            if (error) {
                alert("Ø®Ø·Ø£: " + error.message);
            } else {
                alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø±ØªØ¬Ø¹ Ø¨Ù†Ø¬Ø§Ø­ âœ”");
                location.reload();
            }
        };

        window.onload = loadInvoices;
    </script>
</head>

<body>
    <h2>ğŸ“¦ ØªØ³Ø¬ÙŠÙ„ Ù…Ø±ØªØ¬Ø¹</h2>

    <label>Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label>
    <select id="invoice"></select>

    <label>Ø±Ù‚Ù… Ø§Ù„ØµÙ†Ù</label>
    <input id="product" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ØµÙ†Ù">

    <label>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø©</label>
    <input type="number" id="qty" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">

    <label>Ø§Ù„Ø³Ø¨Ø¨</label>
    <textarea id="reason" rows="4" placeholder="Ø³Ø¨Ø¨ Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea>

    <button onclick="saveReturn()">Ø­ÙØ¸ Ø§Ù„Ù…Ø±ØªØ¬Ø¹</button>
</body>
</html>
