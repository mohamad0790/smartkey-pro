<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø¯ÙŠÙˆÙ† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ | SmartKey Pro</title>
<style>
    body { background:#f0f2f5; font-family:Tahoma; padding:20px; }
    .card { background:#fff; padding:20px; border-radius:12px; box-shadow:0 2px 10px #ccc; max-width:700px; margin:auto; }
    input, select { width:100%; padding:12px; margin-top:6px; border-radius:6px; border:1px solid #bbb; }
    button { padding:12px; width:100%; margin-top:10px; background:#0a7cff; border:none; color:#fff; border-radius:8px; font-size:18px; cursor:pointer; }
</style>
</head>

<body>
<div class="card">

<h2>ğŸ“˜ Ø¯ÙŠÙˆÙ† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>

<label>Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…ÙŠÙ„:</label>
<select id="customerList"></select>

<label>Ø§Ù„Ù…Ø¨Ù„Øº:</label>
<input id="amount" type="number" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº">

<label>Ø§Ù„Ù†ÙˆØ¹:</label>
<select id="type">
  <option value="debt">Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙ†</option>
  <option value="payment">Ø³Ø¯Ø§Ø¯</option>
</select>

<button onclick="saveDebt()">Ø­ÙØ¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</button>

<h3>ğŸ“„ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h3>
<div id="log"></div>

</div>

<script type="module">
import { supabase } from "../js/supabase.js";

window.onload = loadCustomers;

async function loadCustomers() {
    const { data } = await supabase.from("customers").select("*");

    const select = document.getElementById("customerList");
    data.forEach(c => {
        select.innerHTML += `<option value="${c.id}">${c.name}</option>`;
    });

    loadLog();
}

async function saveDebt() {
    const customerId = document.getElementById("customerList").value;
    const amount = document.getElementById("amount").value;
    const type = document.getElementById("type").value;

    if (!amount) return alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº");

    await supabase.from("debts").insert({
        customer_id: customerId,
        amount: amount,
        type: type
    });

    alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­");
    loadLog();
}

async function loadLog() {
    const customerId = document.getElementById("customerList").value;

    const { data } = await supabase
        .from("debts")
        .select("*")
        .eq("customer_id", customerId)
        .order("id", { ascending: false });

    let html = "";
    data.forEach(d => {
        html += `<p>â€¢ ${d.type === "debt" ? "Ø¯ÙŠÙ†" : "Ø³Ø¯Ø§Ø¯"} â€” ${d.amount} Ø±ÙŠØ§Ù„</p>`;
    });

    document.getElementById("log").innerHTML = html;
}
</script>

</body>
</html>
